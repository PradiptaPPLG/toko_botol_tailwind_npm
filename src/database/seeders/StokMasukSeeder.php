<?php

class StokMasukSeeder extends Seeder
{
    public function run(): void
    {
        $this->truncate('stok_masuk');

        // if you want to seed with real examples, use the same data that was in the dump
        $entries = [
            // produk_id, jumlah (botol), harga_beli_satuan, total_belanja, keterangan, batch_id, created_at
            [23, 60, 64000, 3840000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [22, 62, 25000, 1550000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [21, 37, 41000, 1517000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [20, 20, 58000, 1160000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [19, 5, 280000, 1400000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [18, 1, 250000, 250000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [17, 26, 60000, 1560000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [16, 7, 69000, 483000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [15, 12, 62000, 744000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [14, 2, 45000, 90000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [13, 18, 105000, 1890000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [11, 3, 62000, 186000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [10, 18, 45000, 810000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [9, 5, 69000, 345000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [8, 1, 55000, 55000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [7, 7, 60000, 420000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [5, 17, 75000, 1275000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [4, 14, 146000, 2044000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [3, 9, 35000, 315000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [2, 37, 30000, 1110000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [1, 34, 45000, 1530000, '', 'SM-20260228-9574', '2026-02-28 05:03:22'],
            [24,1200,425000,42500000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [6,120,720000,7200000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [2,72,30000,2160000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [7,120,60000,7200000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [14,48,45000,2120000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [12,24,60000,1450000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [9,84,67916,5705000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [8,36,55000,1980000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [3,60,35000,2105000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [10,36,45000,1593000,'','SM-20260228-6899','2026-02-28 05:12:26'],
            [11,60,62000,3725000,'','SM-20260228-6899','2026-02-28 05:12:26'],
        ];

        // botol_perdus lookup; in real seeder you might query produk table
        $botolPerdus = [];
        $res = $this->conn->query("SELECT id, botol_perdus FROM produk");
        while ($row = $res->fetch_assoc()) {
            $botolPerdus[$row['id']] = intval($row['botol_perdus']);
        }

        foreach ($entries as $e) {
            list($produk_id, $jumlah, $harga_beli_satuan, $total_belanja, $keterangan, $batch_id, $created) = $e;
            $bpd = $botolPerdus[$produk_id] ?? 12;
            $harga_perdus = 0;
            if ($jumlah > 0) {
                // jumlah is stored in botol; convert to dus when calculating price per dus
                $jumlahDus = $jumlah / $bpd;
                if ($jumlahDus > 0) {
                    $harga_perdus = intval($total_belanja / $jumlahDus);
                }
            }

            $this->insert('stok_masuk', [
                'produk_id'         => $produk_id,
                'jumlah'            => $jumlah,
                'harga_beli_satuan' => $harga_beli_satuan,
                'harga_perdus'      => $harga_perdus,
                'total_belanja'     => $total_belanja,
                'keterangan'        => $keterangan,
                'batch_id'          => $batch_id,
                'created_at'        => $created,
            ]);
        }
    }
}
